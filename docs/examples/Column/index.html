<!doctype html> <head> <meta charset=utf-8> <meta content="width=device-width" name=viewport> <meta content=#ff00cc name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=layercake-logo-100.png rel=icon type=image/png> <meta content=https://layercake.graphics property=og:site_name> <meta content=article property=og:type> <meta content=summary_large_image name=twitter:card> <meta content=https://layercake.graphics/layercake-logo-1200.png property=og:image> <meta content="Layer Cake" name=og:title> <meta content="A framework for mostly-reusable graphics with svelte" property=og:description> <meta content="A framework for mostly-reusable graphics with svelte" name=description> <meta content="layercake, graphics, svelte, graphics framework, svelte graphics framework, data viz, data visualization, reusable, mostly-reusable" name=keywords> <meta content=https://layercake.graphics property=og:url> <link href=favicon.png rel="shortcut icon" type=image/x-icon> <meta content=https://layercake.graphics name=twitter:site> <meta content="Layer Cake" name=twitter:title> <meta content=https://layercake.graphics/layercake-logo-1200.png name=twitter:image> <style>.chart-container{width:100%;height:100%}.mousecatcher.svelte-1b93ew4{position:fixed;left:0;top:0;width:100vw;height:100vh;background-color:#000;pointer-events:none;opacity:0;z-index:3}.mousecatcher.open.svelte-1b93ew4{pointer-events:all;opacity:.3}@keyframes svelte-1b93ew4-fadein{from{opacity:0}to{opacity:1}}.container.svelte-1b93ew4{position:fixed;width:100%;height:2.5em;background-color:#fff;color:#000;border-bottom:1px solid rgb(170,30,30,.1);font-family:SignPainter,Helvetica,sans-serif;z-index:5}.dropdown.svelte-1b93ew4{position:fixed;top:21px;transform:translate(0,-50%);font-family:SignPainter,Helvetica,sans-serif;font-size:25px;z-index:6;line-height:1;right:1rem;left:auto}.dropdown.svelte-1b93ew4 li.svelte-1b93ew4{padding:0;margin:0;display:inline-block;vertical-align:top}.dropdown.svelte-1b93ew4 li.svelte-1b93ew4:before{color:#000;content:'View...';margin-right:.25em}nav.svelte-1b93ew4{position:fixed;width:14em;height:calc(100vh - 2.5em);top:2.5em;font-family:SignPainter,Helvetica,sans-serif;background-color:#fff;transform:translate(-100%,0);transition:transform .2s cubic-bezier(.17,.67,.24,.99);border-right:1px solid #eee;z-index:5;padding:1em;user-select:none}.open.svelte-1b93ew4{transform:translate(0,0);transition:transform .3s cubic-bezier(.17,.67,.24,.99);overflow-y:auto}.menu-link.svelte-1b93ew4{display:inline;position:absolute;top:50%;left:1rem;transform:translate(0,-50%);font-size:25px;line-height:1;color:#000;cursor:pointer;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}.menu-link.menu-open.svelte-1b93ew4{color:#999}.menu-link.svelte-1b93ew4:hover{text-decoration:underline}.logo.svelte-1b93ew4{position:absolute;top:50%;left:50%;transform:translate(-50%,-45%);-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;line-height:1;text-decoration:none;font-weight:700;color:#000;font-size:25px}ul.svelte-1b93ew4{display:block;margin:0;padding:0;list-style:none}.primary.svelte-1b93ew4{margin:0 0 .5em 0}.primary.svelte-1b93ew4 li.svelte-1b93ew4{position:relative;display:block}.primary.svelte-1b93ew4 li a.svelte-1b93ew4{display:block;font-size:25px;padding:0 0 .75em 0;text-decoration:none;line-height:1}.logo.svelte-1b93ew4:hover,.primary.svelte-1b93ew4 a.svelte-1b93ew4:hover{text-decoration:underline}.secondary.svelte-1b93ew4{font-family:Helvetica,sans-serif;padding-bottom:2em}.secondary.svelte-1b93ew4 .guide-toc>li{margin-bottom:1.5em!important}@media(max-width:450px){.dropdown.svelte-1b93ew4 select.svelte-1b93ew4{max-width:60px}}@media(max-width:500px){.dropdown.svelte-1b93ew4 li.svelte-1b93ew4:before{content:''}}@media(min-width:1100px){.dropdown.svelte-1b93ew4{left:calc((100vw - 800px)/ 2)!important;transform:translate(0,0)!important}}@media(min-width:645px){.menu-link.svelte-1b93ew4,.mousecatcher.svelte-1b93ew4{display:none}.dropdown.svelte-1b93ew4{top:1rem;left:50%;transform:translate(-50%,0);right:auto}.dropdown.svelte-1b93ew4 li.svelte-1b93ew4:before{content:'View example...';margin-right:.25em}.container.svelte-1b93ew4{height:3.5em}nav.svelte-1b93ew4{width:100%;height:3.5em;padding:0 1.5em 0 0;transform:none;transition:none;height:0}.primary.svelte-1b93ew4{position:fixed;top:1rem;right:1.5rem;margin:0}.primary.svelte-1b93ew4 li.svelte-1b93ew4{display:inline-block;position:relative;padding:0 1em}.primary.svelte-1b93ew4 li.svelte-1b93ew4:first-child::after{position:absolute;top:-2px;right:-3px;content:'|';font-size:25px}.primary.svelte-1b93ew4 li.svelte-1b93ew4:last-child::after{content:''}.secondary.svelte-1b93ew4{display:none}.logo.svelte-1b93ew4{position:absolute;top:1rem;left:1.5rem;text-decoration:none;transform:none}}.guide-toc.svelte-12f7dp8{margin:0;padding:0}.guide-toc.svelte-12f7dp8 a.svelte-12f7dp8{text-decoration:none}.guide-toc.svelte-12f7dp8 a.svelte-12f7dp8:hover{text-decoration:underline}.guide-toc.svelte-12f7dp8 li.svelte-12f7dp8{display:block;margin:0 0 1.5em 0}.section.svelte-12f7dp8{display:block;font-weight:700;color:#333;font-size:1.2rem;margin:0 0 .15em 0}.subsection.svelte-12f7dp8{display:block;color:#727272;font-size:1em;margin:0 0 .15em 0}.section.active.svelte-12f7dp8,.subsection.active.svelte-12f7dp8{color:#f0c}.main.svelte-1b1cja3{position:relative;max-width:54em;background-color:#fff;padding:1.5em 2em 2em 2em;margin:0 auto;box-sizing:border-box}.chart-hero.svelte-1b1cja3{width:100%;height:200px;margin:1.5em 0 2em 0}#pages.svelte-1b1cja3{margin-top:50px}#pages.has-dek.svelte-1b1cja3{margin-top:35px}.dek.svelte-1b1cja3{width:calc(100% - 80px)}#contents-container.svelte-1b1cja3{border-left:3px solid #ccc;margin-top:7px}pre.svelte-1b1cja3{margin-top:7px 0 0 0;padding-left:14px;overflow-x:auto}#page-nav.svelte-1b1cja3{margin:0;padding:0}.tab.svelte-1b1cja3{display:inline-block;vertical-align:top;margin-right:14px;margin-bottom:8px;border-bottom:2px solid transparent;color:#ccc}@media(max-width:475px){#pages.svelte-1b1cja3{margin-top:21px}.tab.svelte-1b1cja3{margin-top:8px;margin-bottom:0}.download.svelte-1b1cja3{display:none}.dek.svelte-1b1cja3{width:100%}}.tab.svelte-1b1cja3:hover{border-bottom:2px solid #aaa;cursor:pointer}.tab.active{color:#000;pointer-events:none;border-bottom:2px solid #000}button.svelte-1m5nccx{font-weight:200;font-family:Helvetica,sans-serif;outline:0;padding:0;border:none;float:right;cursor:pointer;transform:translateY(-6px)}.icon.svelte-1m5nccx{color:transparent;font-size:16px;height:2em;background:transparent no-repeat 100% 0;background-size:1.6em 1.6em;opacity:.6}.icon.svelte-1m5nccx:before{content:'Download';color:#000;display:inline-block;transform:translate(100%,0)}.icon.svelte-1m5nccx:hover{opacity:1}.icon.svelte-1m5nccx:disabled{filter:grayscale(1);opacity:.4;cursor:default}.icon.svelte-1m5nccx:disabled:before{content:'Please wait...';transform:translate(75%,0)}@keyframes svelte-1m5nccx-zoom-in{0%{transform:scale(0);opacity:0}100%{transform:scale(1);opacity:1}}@keyframes svelte-1m5nccx-fade-in{0%{opacity:0}100%{opacity:.6}}</style> <noscript id=sapper-head-start></noscript><title>Layer Cake - Column (with annotation)</title><link href=hljs.css rel=stylesheet><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper><div class="svelte-1b93ew4 closed mousecatcher"></div> <div class="svelte-1b93ew4 container"> <span class="svelte-1b93ew4 menu-closed menu-link">Menu</span> <a class="svelte-1b93ew4 logo" href=.>Layer Cake</a> </div> <ul class="svelte-1b93ew4 dropdown"> <li class=svelte-1b93ew4> <select class=svelte-1b93ew4> <option value="">All</option> <option value=examples/Line>Line + area<option value=examples/Scatter>Scatter<option value=examples/MapSvg>Map<option value=examples/MapLayered>Multilayer map<option value=examples/Column>Column<option value=examples/ColumnStacked>Stacked column<option value=examples/Bar>Bar<option value=examples/BarStacked>Stacked bar<option value=examples/MultiLine>Multiline<option value=examples/AreaStacked>Stacked area<option value=examples/ScatterWebgl>WebGl Scatter<option value=examples/ClevelandDotPlot>Cleveland dot plot<option value=examples/Histogram>Histogram<option value=examples/SmallMultiples>Small multiples</option> </select> </li> </ul> <nav class="svelte-1b93ew4 closed"> <ul class="svelte-1b93ew4 primary"> <li class=svelte-1b93ew4><a class=svelte-1b93ew4 href=guide rel=prefetch>Guide</a></li> <li class=svelte-1b93ew4><a class=svelte-1b93ew4 href=https://github.com/mhkeller/layercake>GitHub</a></li> </ul> <div class="svelte-1b93ew4 secondary"> <ul class="svelte-12f7dp8 guide-toc"> <li class=svelte-12f7dp8> <a class="svelte-12f7dp8 section" href=guide#introduction>Introduction</a> <a class="svelte-12f7dp8 subsection" href=guide#what-is-layer-cake->What is Layer Cake?</a><a class="svelte-12f7dp8 subsection" href=guide#getting-started>Getting started</a><a class="svelte-12f7dp8 subsection" href=guide#layer-components>Layer components</a><a class="svelte-12f7dp8 subsection" href=guide#more-layer-types>More layer types</a><a class="svelte-12f7dp8 subsection" href=guide#data-less-cakes>Data-less cakes</a> <li class=svelte-12f7dp8> <a class="svelte-12f7dp8 section" href=guide#store-api>Store API</a> <a class="svelte-12f7dp8 subsection" href=guide#target-dom-node>target</a><a class="svelte-12f7dp8 subsection" href=guide#data-array>data</a><a class="svelte-12f7dp8 subsection" href=guide#x-string-function-array>x</a><a class="svelte-12f7dp8 subsection" href=guide#y-string-function-array>y</a><a class="svelte-12f7dp8 subsection" href=guide#r-string-function-array>r</a><a class="svelte-12f7dp8 subsection" href=guide#padding-object>padding</a><a class="svelte-12f7dp8 subsection" href=guide#xscale-d3scale->xScale</a><a class="svelte-12f7dp8 subsection" href=guide#yscale-d3scale->yScale</a><a class="svelte-12f7dp8 subsection" href=guide#rscale-d3scale->rScale</a><a class="svelte-12f7dp8 subsection" href=guide#xdomain-array-min-max->xDomain</a><a class="svelte-12f7dp8 subsection" href=guide#ydomain-array-min-max->yDomain</a><a class="svelte-12f7dp8 subsection" href=guide#rdomain-array-min-max->rDomain</a><a class="svelte-12f7dp8 subsection" href=guide#reversex-boolean-false>reverseX</a><a class="svelte-12f7dp8 subsection" href=guide#reversey-boolean-true>reverseY</a><a class="svelte-12f7dp8 subsection" href=guide#xpadding-array-leftpixels-rightpixels->xPadding</a><a class="svelte-12f7dp8 subsection" href=guide#ypadding-array-leftpixels-rightpixels->yPadding</a><a class="svelte-12f7dp8 subsection" href=guide#rpadding-array-leftpixels-rightpixels->rPadding</a><a class="svelte-12f7dp8 subsection" href=guide#rrange-array-min-max->rRange</a><a class="svelte-12f7dp8 subsection" href=guide#flatdata-array>flatData</a> <li class=svelte-12f7dp8> <a class="svelte-12f7dp8 section" href=guide#cake-api>Cake API</a> <a class="svelte-12f7dp8 subsection" href=guide#cake-svglayers-componentslist-opts->cake.svgLayers(...)</a><a class="svelte-12f7dp8 subsection" href=guide#cake-htmllayers-componentslist-opts->cake.htmlLayers(...)</a><a class="svelte-12f7dp8 subsection" href=guide#cake-canvaslayers-componentslist-opts->cake.canvasLayers(...)</a><a class="svelte-12f7dp8 subsection" href=guide#cake-webgllayers-componentslist-opts->cake.webglLayers(...)</a><a class="svelte-12f7dp8 subsection" href=guide#cake-render-options->cake.render(...)</a> <li class=svelte-12f7dp8> <a class="svelte-12f7dp8 section" href=guide#computed-store-functions>Computed Store Properties</a> <a class="svelte-12f7dp8 subsection" href=guide#box>box</a><a class="svelte-12f7dp8 subsection" href=guide#xget-datarow->xGet(...)</a><a class="svelte-12f7dp8 subsection" href=guide#yget-datarow->yGet(...)</a><a class="svelte-12f7dp8 subsection" href=guide#rget-datarow->rGet(...)</a> <li class=svelte-12f7dp8> <a class="svelte-12f7dp8 section" href=guide#helper-functions>Helper functions</a> <a class="svelte-12f7dp8 subsection" href=guide#newdiv-classname-stylesobject-parentdomnode->newDiv(...)</a><a class="svelte-12f7dp8 subsection" href=guide#flatten-data->flatten(...)</a><a class="svelte-12f7dp8 subsection" href=guide#scalecanvas-canvas-ctx-width-height->scaleCanvas(...)</a><a class="svelte-12f7dp8 subsection" href=guide#calcextents-flatdata-fields->calcExtents(...)</a> </li> </ul> </div> </nav> <main> <div class="svelte-1b1cja3 main"> <h1>Column (with annotation)</h1> <div class="svelte-1b1cja3 chart-hero"> <div class=chart-container></div> </div> <div class="svelte-1b1cja3 download"> <button class="icon svelte-1m5nccx" style=background-image:url(icons/download.svg) title="download zip file">Download      </button> </div> <div class=svelte-1b1cja3 id=pages> <ul class=svelte-1b1cja3 id=page-nav> <li class="svelte-1b1cja3 tab active">main.js<li class="svelte-1b1cja3 tab">./components/Column.html<li class="svelte-1b1cja3 tab">./components/AxisXScaleBand.html<li class="svelte-1b1cja3 tab">./components/AxisY.html<li class="svelte-1b1cja3 tab">./components/Annotations.html<li class="svelte-1b1cja3 tab">./components/Arrows.html<li class="svelte-1b1cja3 tab">./components/DefArrowhead.html<li class="svelte-1b1cja3 tab">./data/groups.js<li class="svelte-1b1cja3 tab">../modules/swoopyArrow.js<li class="svelte-1b1cja3 tab">../modules/getElPosition.js<li class="svelte-1b1cja3 tab">../modules/parseCssValue.js</li> </ul> <div class=svelte-1b1cja3 id=contents-container> <div class=contents style=display:block> <pre class=svelte-1b1cja3><span class=hljs-keyword>import</span> LayerCake <span class=hljs-keyword>from</span> <span class=hljs-string>'layercake'</span>;
<span class=hljs-keyword>import</span> { scaleBand } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-scale'</span>;
<span class=hljs-keyword>import</span> groups <span class=hljs-keyword>from</span> <span class=hljs-string>'./data/groups.js'</span>;
<span class=hljs-keyword>import</span> Column <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/Column.html'</span>;
<span class=hljs-keyword>import</span> AxisX <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/AxisXScaleBand.html'</span>;
<span class=hljs-keyword>import</span> AxisY <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/AxisY.html'</span>;
<span class=hljs-keyword>import</span> Annotations <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/Annotations.html'</span>;
<span class=hljs-keyword>import</span> Arrows <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/Arrows.html'</span>;
<span class=hljs-keyword>import</span> DefArrowhead <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/DefArrowhead.html'</span>;

<span class=hljs-keyword>const</span> annotations = [
  {
    <span class=hljs-attr>text</span>: <span class=hljs-string>'Example text...'</span>,
    <span class=hljs-attr>top</span>: <span class=hljs-string>'18%'</span>,
    <span class=hljs-attr>left</span>: <span class=hljs-string>'30%'</span>,
    <span class=hljs-attr>arrows</span>: [{
      <span class=hljs-attr>clockwise</span>: <span class=hljs-literal>false</span>, <span class=hljs-comment>// true or false, defaults to true</span>
      source: {
        <span class=hljs-attr>anchor</span>: <span class=hljs-string>'left-bottom'</span>, <span class=hljs-comment>// can be `{left, middle, right},{top-middle-bottom}`</span>
        dx: <span class=hljs-number>-2</span>,
        <span class=hljs-attr>dy</span>: <span class=hljs-number>-7</span>
      },
      <span class=hljs-attr>target</span>: {
        <span class=hljs-attr>x</span>: <span class=hljs-string>'28%'</span>,
        <span class=hljs-attr>y</span>: <span class=hljs-string>'75%'</span>
      }
    },
    {
      <span class=hljs-attr>source</span>: {
        <span class=hljs-attr>anchor</span>: <span class=hljs-string>'right-bottom'</span>,
        <span class=hljs-attr>dy</span>: <span class=hljs-number>-7</span>,
        <span class=hljs-attr>dx</span>: <span class=hljs-number>5</span>
      },
      <span class=hljs-attr>target</span>: {
        <span class=hljs-attr>x</span>: <span class=hljs-string>'68%'</span>,
        <span class=hljs-attr>y</span>: <span class=hljs-string>'48%'</span>
      }
    }]
  }
];

<span class=hljs-keyword>const</span> myCake = <span class=hljs-keyword>new</span> LayerCake({
  <span class=hljs-attr>padding</span>: { <span class=hljs-attr>top</span>: <span class=hljs-number>0</span>, <span class=hljs-attr>right</span>: <span class=hljs-number>0</span>, <span class=hljs-attr>bottom</span>: <span class=hljs-number>20</span>, <span class=hljs-attr>left</span>: <span class=hljs-number>20</span> },
  <span class=hljs-attr>x</span>: <span class=hljs-string>'year'</span>,
  <span class=hljs-attr>y</span>: <span class=hljs-string>'value'</span>,
  <span class=hljs-attr>xScale</span>: scaleBand().paddingInner([<span class=hljs-number>0.02</span>]).round(<span class=hljs-literal>true</span>),
  <span class=hljs-attr>xDomain</span>: [<span class=hljs-string>'1979'</span>, <span class=hljs-string>'1980'</span>, <span class=hljs-string>'1981'</span>, <span class=hljs-string>'1982'</span>, <span class=hljs-string>'1983'</span>],
  <span class=hljs-attr>yDomain</span>: [<span class=hljs-number>0</span>, <span class=hljs-literal>null</span>],
  <span class=hljs-attr>data</span>: groups,
  <span class=hljs-attr>target</span>: <span class=hljs-built_in>document</span>.getElementById(<span class=hljs-string>'my-chart'</span>)
})
  .svgLayers([
    { <span class=hljs-attr>component</span>: AxisX, <span class=hljs-attr>opts</span>: { <span class=hljs-attr>gridlines</span>: <span class=hljs-literal>false</span> } },
    { <span class=hljs-attr>component</span>: AxisY, <span class=hljs-attr>opts</span>: { <span class=hljs-attr>gridlines</span>: <span class=hljs-literal>false</span>, <span class=hljs-attr>ticks</span>: <span class=hljs-number>3</span> } },
    { <span class=hljs-attr>component</span>: Column, <span class=hljs-attr>opts</span>: {} }
  ])
  .htmlLayers([
    { <span class=hljs-attr>component</span>: Annotations, <span class=hljs-attr>opts</span>: { annotations } }
  ])
  .svgLayers([
    { <span class=hljs-attr>component</span>: Arrows, <span class=hljs-attr>opts</span>: { annotations } }
  ], { <span class=hljs-attr>defs</span>: DefArrowhead });

myCake.render();</pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3>{#each $data as d, i}
  <span class=hljs-tag>&lt;<span class=hljs-name>rect</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'group-rect'</span> <span class=hljs-attr>data-id</span>=<span class=hljs-string>"{i}"</span> <span class=hljs-attr>x</span>=<span class=hljs-string>"{x(d)}"</span> <span class=hljs-attr>y</span>=<span class=hljs-string>"{y(d)}"</span> {<span class=hljs-attr>width</span>} <span class=hljs-attr>height</span>=<span class=hljs-string>"{height(d)}"</span>
  <span class=hljs-attr>fill</span>=<span class=hljs-string>{opts.fill</span> || '#<span class=hljs-attr>00e047</span>'} <span class=hljs-attr>stroke</span>=<span class=hljs-string>{opts.stroke</span> || ''} <span class=hljs-attr>stroke-width</span>=<span class=hljs-string>{opts[</span>'<span class=hljs-attr>stroke-width</span>'] || ''}></span><span class=hljs-tag>&lt;/<span class=hljs-name>rect</span>></span>
{/each}

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
  <span class=hljs-attr>namespace</span>: <span class=hljs-string>'svg'</span>,
  <span class=hljs-attr>computed</span>: {
    <span class=hljs-attr>x</span>: <span class=hljs-function>(<span class=hljs-params>{ $xGet }</span>) =></span> {
      <span class=hljs-keyword>return</span> <span class=hljs-function>(<span class=hljs-params>d</span>) =></span> {
        <span class=hljs-keyword>return</span> $xGet(d);
      };
    },
    <span class=hljs-attr>y</span>: <span class=hljs-function>(<span class=hljs-params>{ $yGet }</span>) =></span> {
      <span class=hljs-keyword>return</span> <span class=hljs-function>(<span class=hljs-params>d</span>) =></span> {
        <span class=hljs-keyword>return</span> $yGet(d);
      };
    },
    <span class=hljs-attr>width</span>: <span class=hljs-function>(<span class=hljs-params>{ $xScale }</span>) =></span> {
      <span class=hljs-keyword>return</span> $xScale.bandwidth();
    },
    <span class=hljs-attr>height</span>: <span class=hljs-function>(<span class=hljs-params>{ $height, $xScale, y }</span>) =></span> {
      <span class=hljs-keyword>return</span> <span class=hljs-function>(<span class=hljs-params>d</span>) =></span> {
        <span class=hljs-keyword>return</span> $height - y(d);
      };
    }
  }
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'axis x-axis'</span>></span>
  {#each $xScale.domain() as tick}
    <span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'tick tick-{ tick }'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate({$xScale(tick)},{$yScale.range()[0]})'</span>></span>
      {#if opts.gridlines !== false}
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span> <span class=hljs-attr>y1</span>=<span class=hljs-string>'{$height * -1}'</span> <span class=hljs-attr>y2</span>=<span class=hljs-string>'0'</span> <span class=hljs-attr>x1</span>=<span class=hljs-string>'0'</span> <span class=hljs-attr>x2</span>=<span class=hljs-string>'0'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      {/if}
      <span class=hljs-tag>&lt;<span class=hljs-name>text</span> <span class=hljs-attr>y</span>=<span class=hljs-string>'16'</span> <span class=hljs-attr>x</span>=<span class=hljs-string>"{$xScale.bandwidth() / 2}"</span>></span>{opts.formatTick ? opts.formatTick(tick) : tick}<span class=hljs-tag>&lt;/<span class=hljs-name>text</span>></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>
  {/each}
<span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span><span class=css>
  <span class=hljs-selector-class>.tick</span> {
    <span class=hljs-attribute>font-size</span>: .<span class=hljs-number>725em</span>;
    <span class=hljs-attribute>font-weight</span>: <span class=hljs-number>200</span>;
  }

  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-tag>line</span> {
    <span class=hljs-attribute>stroke</span>: <span class=hljs-number>#aaa</span>;
    <span class=hljs-attribute>stroke-dasharray</span>: <span class=hljs-number>2</span>;
  }

  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-tag>text</span> {
    <span class=hljs-attribute>fill</span>: <span class=hljs-number>#666</span>;
    <span class=hljs-attribute>text-anchor</span>: start;
  }

  <span class=hljs-selector-class>.tick</span><span class=hljs-selector-class>.tick-0</span> <span class=hljs-selector-tag>line</span> {
    <span class=hljs-attribute>stroke-dasharray</span>: <span class=hljs-number>0</span>;
  }

  <span class=hljs-selector-class>.x-axis</span> <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-tag>text</span> {
    <span class=hljs-attribute>text-anchor</span>: middle;
  }
</span><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=actionscript>
export <span class=hljs-keyword>default</span> {
  <span class=hljs-keyword>namespace</span>: <span class=hljs-string>'svg'</span>
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'axis y-axis'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate(-{$padding.left}, 0)'</span>></span>
  {#each $yScale.ticks(opts.tickNumber || 5) as tick, i}
    <span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'tick tick-{tick}'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate(0, {$yScale(tick)})'</span>></span>
      {#if opts.gridlines !== false}
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span> <span class=hljs-attr>x2</span>=<span class=hljs-string>'100%'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      {/if}
      <span class=hljs-tag>&lt;<span class=hljs-name>text</span> <span class=hljs-attr>y</span>=<span class=hljs-string>'-4'</span>></span>{opts.formatTick ? opts.formatTick(tick) : tick}<span class=hljs-tag>&lt;/<span class=hljs-name>text</span>></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>
  {/each}
<span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span><span class=css>
  <span class=hljs-selector-class>.tick</span> {
    <span class=hljs-attribute>font-size</span>: .<span class=hljs-number>725em</span>;
    <span class=hljs-attribute>font-weight</span>: <span class=hljs-number>200</span>;
  }

  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-tag>line</span> {
    <span class=hljs-attribute>stroke</span>: <span class=hljs-number>#aaa</span>;
    <span class=hljs-attribute>stroke-dasharray</span>: <span class=hljs-number>2</span>;
  }

  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-tag>text</span> {
    <span class=hljs-attribute>fill</span>: <span class=hljs-number>#666</span>;
    <span class=hljs-attribute>text-anchor</span>: start;
  }

  <span class=hljs-selector-class>.tick</span><span class=hljs-selector-class>.tick-0</span> <span class=hljs-selector-tag>line</span> {
    <span class=hljs-attribute>stroke-dasharray</span>: <span class=hljs-number>0</span>;
  }
</span><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=actionscript>
export <span class=hljs-keyword>default</span> {
  <span class=hljs-keyword>namespace</span>: <span class=hljs-string>'svg'</span>
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3>{#each opts.annotations as d, i}
  <span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"layercake-annotation"</span> <span class=hljs-attr>data-id</span>=<span class=hljs-string>"{i}"</span> <span class=hljs-attr>style</span>=<span class=hljs-string>"{fillStyle(d)}"</span>></span>{d.text}<span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
{/each}

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span><span class=css>
  <span class=hljs-selector-class>.layercake-annotation</span> {
    <span class=hljs-attribute>position</span>: absolute;
  }
</span><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
<span class=hljs-keyword>const</span> vals = [<span class=hljs-string>'top'</span>, <span class=hljs-string>'right'</span>, <span class=hljs-string>'bottom'</span>, <span class=hljs-string>'left'</span>];
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
  onupdate () {
    <span class=hljs-comment>/* --------------------------------------------
     * Stash this on the store so that our arrow annotation layer can hook onto these DOM elemnts
     * only after they're created, and then on update
     */</span>
    <span class=hljs-keyword>this</span>.store.set({ <span class=hljs-attr>annotationEls</span>: <span class=hljs-built_in>document</span>.querySelectorAll(<span class=hljs-string>'.layercake-annotation'</span>) });
  },
  <span class=hljs-attr>computed</span>: {
    <span class=hljs-attr>fillStyle</span>: <span class=hljs-function>(<span class=hljs-params>{ $width, $height }</span>) =></span> {
      <span class=hljs-keyword>return</span> <span class=hljs-function><span class=hljs-params>d</span> =></span> {
        <span class=hljs-keyword>let</span> style = <span class=hljs-string>''</span>;
        vals.forEach(<span class=hljs-function><span class=hljs-params>val</span> =></span> {
          <span class=hljs-keyword>if</span> (d[val]) {
            style += <span class=hljs-string>`<span class=hljs-subst>${val}</span>:<span class=hljs-subst>${d[val]}</span>;`</span>;
          }
        });
        <span class=hljs-keyword>return</span> style;
      };
    }
  }
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3>{#if opts.annotations}
  <span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"swoops"</span>></span>
    {#each opts.annotations as anno, i}
      {#if anno.arrows}
        {#each anno.arrows as arrow}
          <span class=hljs-tag>&lt;<span class=hljs-name>path</span> <span class=hljs-attr>marker-end</span>=<span class=hljs-string>'url(#arrowhead)'</span> <span class=hljs-attr>d</span>=<span class=hljs-string>'{d(anno, i, arrow)}'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>path</span>></span>
        {/each}
      {/if}
    {/each}
  <span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>
{/if}

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span><span class=css>
  <span class=hljs-selector-class>.swoops</span> {
    <span class=hljs-attribute>position</span>: absolute;
    <span class=hljs-attribute>max-width</span>: <span class=hljs-number>200px</span>;
    <span class=hljs-attribute>line-height</span>: <span class=hljs-number>14px</span>;
  }
  <span class=hljs-selector-class>.swoops</span> <span class=hljs-selector-tag>path</span> {
    <span class=hljs-attribute>fill</span>: none;
    <span class=hljs-attribute>stroke</span>: <span class=hljs-number>#000</span>;
    <span class=hljs-attribute>stroke-width</span>: <span class=hljs-number>1</span>;
  }
</span><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
<span class=hljs-keyword>import</span> swoopyArrow <span class=hljs-keyword>from</span> <span class=hljs-string>'../modules/swoopyArrow.js'</span>;
<span class=hljs-keyword>import</span> getElPosition <span class=hljs-keyword>from</span> <span class=hljs-string>'../modules/getElPosition.js'</span>;
<span class=hljs-keyword>import</span> parseCssValue <span class=hljs-keyword>from</span> <span class=hljs-string>'../modules/parseCssValue.js'</span>;

<span class=hljs-comment>/* --------------------------------------------
 * Some lookups to convert between x, y / width, height terminology
 * and CSS names
 */</span>
<span class=hljs-keyword>const</span> lookups = [
  { <span class=hljs-attr>dimension</span>: <span class=hljs-string>'width'</span>, <span class=hljs-attr>css</span>: <span class=hljs-string>'left'</span>, <span class=hljs-attr>position</span>: <span class=hljs-string>'x'</span> },
  { <span class=hljs-attr>dimension</span>: <span class=hljs-string>'height'</span>, <span class=hljs-attr>css</span>: <span class=hljs-string>'top'</span>, <span class=hljs-attr>position</span>: <span class=hljs-string>'y'</span> }
];

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
  <span class=hljs-attr>namespace</span>: <span class=hljs-string>'svg'</span>,
  <span class=hljs-attr>computed</span>: {
    <span class=hljs-attr>d</span>: <span class=hljs-function>(<span class=hljs-params>{ $width, $height, opts, $annotationEls }</span>) =></span> {
      <span class=hljs-keyword>return</span> <span class=hljs-function>(<span class=hljs-params>anno, i, arrow</span>) =></span> {
        <span class=hljs-keyword>if</span> ($annotationEls) {
          <span class=hljs-keyword>const</span> el = $annotationEls[i];
          <span class=hljs-comment>// const el = document.querySelector(`.layercake-annotation[data-id="${i}"]`);</span>
          <span class=hljs-comment>/* --------------------------------------------
           * Parse our attachment directives to know where to start the arrowhead
           * measuring a bounding box based on our annotation el
           */</span>
          <span class=hljs-keyword>const</span> arrowSource = getElPosition(el);
          <span class=hljs-keyword>const</span> sourceCoords = arrow.source.anchor.split(<span class=hljs-string>'-'</span>).map(<span class=hljs-function>(<span class=hljs-params>d, i</span>) =></span> {
            <span class=hljs-keyword>const</span> point = d === <span class=hljs-string>'middle'</span> ? arrowSource[lookups[i].css] + (arrowSource[lookups[i].dimension] / <span class=hljs-number>2</span>) : arrowSource[d];
            <span class=hljs-keyword>return</span> point + (parseCssValue(arrow.source[<span class=hljs-string>`d<span class=hljs-subst>${lookups[i].position}</span>`</span>], i, arrowSource.width, arrowSource.height));
          });

          <span class=hljs-comment>/* --------------------------------------------
           * Default to clockwise
           */</span>
          <span class=hljs-keyword>const</span> clockwise = <span class=hljs-keyword>typeof</span> arrow.clockwise === <span class=hljs-string>'undefined'</span> ? <span class=hljs-literal>true</span> : arrow.clockwise;

          <span class=hljs-comment>/* --------------------------------------------
           * Parse where we're drawing to
           */</span>
          <span class=hljs-keyword>const</span> targetCoords = [arrow.target.x, arrow.target.y].map(<span class=hljs-function>(<span class=hljs-params>d, i</span>) =></span> {
            <span class=hljs-keyword>return</span> parseCssValue(d, i, $width, $height);
          });

          <span class=hljs-comment>/* --------------------------------------------
           * Create arrow path
           */</span>
          <span class=hljs-keyword>const</span> d = swoopyArrow()
            .angle(<span class=hljs-built_in>Math</span>.PI / <span class=hljs-number>2</span>)
            .clockwise(clockwise)
            .x(<span class=hljs-function><span class=hljs-params>d</span> =></span> d[<span class=hljs-number>0</span>])
            .y(<span class=hljs-function><span class=hljs-params>d</span> =></span> d[<span class=hljs-number>1</span>])([sourceCoords, targetCoords]);

          <span class=hljs-keyword>return</span> d;
        }
        <span class=hljs-keyword>return</span> <span class=hljs-string>''</span>;
      };
    }
  }
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-tag>&lt;<span class=hljs-name>defs</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>marker</span> <span class=hljs-attr>id</span>=<span class=hljs-string>"arrowhead"</span> <span class=hljs-attr>viewBox</span>=<span class=hljs-string>"-10 -10 20 20"</span> <span class=hljs-attr>markerWidth</span>=<span class=hljs-string>"17"</span> <span class=hljs-attr>markerHeight</span>=<span class=hljs-string>"17"</span> <span class=hljs-attr>orient</span>=<span class=hljs-string>"auto"</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>path</span> <span class=hljs-attr>d</span>=<span class=hljs-string>"M-6,-6 L 0,0 L -6,6"</span> <span class=hljs-attr>fill</span>=<span class=hljs-string>"{opts.fill || '#000'}"</span>/></span>
  <span class=hljs-tag>&lt;/<span class=hljs-name>marker</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>defs</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=actionscript>
export <span class=hljs-keyword>default</span> {
  <span class=hljs-keyword>namespace</span>: <span class=hljs-string>'svg'</span>
};
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> [
  {
    <span class=hljs-attr>year</span>: <span class=hljs-string>'1979'</span>,
    <span class=hljs-attr>value</span>: <span class=hljs-number>2</span>
  },
  {
    <span class=hljs-attr>year</span>: <span class=hljs-string>'1980'</span>,
    <span class=hljs-attr>value</span>: <span class=hljs-number>3</span>
  },
  {
    <span class=hljs-attr>year</span>: <span class=hljs-string>'1981'</span>,
    <span class=hljs-attr>value</span>: <span class=hljs-number>5</span>
  },
  {
    <span class=hljs-attr>year</span>: <span class=hljs-string>'1982'</span>,
    <span class=hljs-attr>value</span>: <span class=hljs-number>8</span>
  },
  {
    <span class=hljs-attr>year</span>: <span class=hljs-string>'1983'</span>,
    <span class=hljs-attr>value</span>: <span class=hljs-number>18</span>
  }
];</pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-comment>/* --------------------------------------------
 *
 * Adapted from bizweekgraphics/swoopyarrows
 *
 * --------------------------------------------
 */</span>
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>swoopyArrow</span> (<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>let</span> angle = <span class=hljs-built_in>Math</span>.PI;
  <span class=hljs-keyword>let</span> clockwise = <span class=hljs-literal>true</span>;
  <span class=hljs-keyword>let</span> xValue = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>d</span>) </span>{ <span class=hljs-keyword>return</span> d[<span class=hljs-number>0</span>]; };
  <span class=hljs-keyword>let</span> yValue = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>d</span>) </span>{ <span class=hljs-keyword>return</span> d[<span class=hljs-number>1</span>]; };

  <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>render</span>(<span class=hljs-params>data</span>) </span>{
    data = data.map(<span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>d, i</span>) </span>{
      <span class=hljs-keyword>return</span> [xValue.call(data, d, i), yValue.call(data, d, i)];
    });

    <span class=hljs-comment>// get the chord length ("height" {h}) between points</span>
    <span class=hljs-keyword>const</span> h = hypotenuse(data[<span class=hljs-number>1</span>][<span class=hljs-number>0</span>] - data[<span class=hljs-number>0</span>][<span class=hljs-number>0</span>], data[<span class=hljs-number>1</span>][<span class=hljs-number>1</span>] - data[<span class=hljs-number>0</span>][<span class=hljs-number>1</span>]);

    <span class=hljs-comment>// get the distance at which chord of height h subtends {angle} radians</span>
    <span class=hljs-keyword>const</span> d = h / (<span class=hljs-number>2</span> * <span class=hljs-built_in>Math</span>.tan(angle / <span class=hljs-number>2</span>));

    <span class=hljs-comment>// get the radius {r} of the circumscribed circle</span>
    <span class=hljs-keyword>const</span> r = hypotenuse(d, h / <span class=hljs-number>2</span>);

    <span class=hljs-comment>/*
    SECOND, compose the corresponding SVG arc.
      read up: http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands
      example: &lt;path d = "M 200,50 a 50,50 0 0,1 100,0"/>
                          M 200,50                          Moves pen to (200,50);
                                   a                        draws elliptical arc;
                                     50,50                  following a degenerate ellipse, r1 == r2 == 50;
                                                            i.e. a circle of radius 50;
                                           0                with no x-axis-rotation (irrelevant for circles);
                                             0,1            with large-axis-flag=0 and sweep-flag=1 (clockwise);
                                                 100,0      to a point +100 in x and +0 in y, i.e. (300,50).
    */</span>
    <span class=hljs-keyword>const</span> path = <span class=hljs-string>'M '</span> + data[<span class=hljs-number>0</span>][<span class=hljs-number>0</span>] + <span class=hljs-string>','</span> + data[<span class=hljs-number>0</span>][<span class=hljs-number>1</span>] +
        <span class=hljs-string>' a '</span> + r + <span class=hljs-string>','</span> + r +
        <span class=hljs-string>' 0 0,'</span> + (clockwise ? <span class=hljs-string>'1'</span> : <span class=hljs-string>'0'</span>) + <span class=hljs-string>' '</span> +
        (data[<span class=hljs-number>1</span>][<span class=hljs-number>0</span>] - data[<span class=hljs-number>0</span>][<span class=hljs-number>0</span>]) + <span class=hljs-string>','</span> + (data[<span class=hljs-number>1</span>][<span class=hljs-number>1</span>] - data[<span class=hljs-number>0</span>][<span class=hljs-number>1</span>]);

    <span class=hljs-keyword>return</span> path;
  }

  <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>hypotenuse</span>(<span class=hljs-params>a, b</span>) </span>{
    <span class=hljs-keyword>return</span> <span class=hljs-built_in>Math</span>.sqrt(<span class=hljs-built_in>Math</span>.pow(a, <span class=hljs-number>2</span>) + <span class=hljs-built_in>Math</span>.pow(b, <span class=hljs-number>2</span>));
  }

  render.angle = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>_</span>) </span>{
    <span class=hljs-keyword>if</span> (!<span class=hljs-built_in>arguments</span>.length) <span class=hljs-keyword>return</span> angle;
    angle = <span class=hljs-built_in>Math</span>.min(<span class=hljs-built_in>Math</span>.max(_, <span class=hljs-number>1e-6</span>), <span class=hljs-built_in>Math</span>.PI - <span class=hljs-number>1e-6</span>);
    <span class=hljs-keyword>return</span> render;
  };

  render.clockwise = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>_</span>) </span>{
    <span class=hljs-keyword>if</span> (!<span class=hljs-built_in>arguments</span>.length) <span class=hljs-keyword>return</span> clockwise;
    clockwise = !!_;
    <span class=hljs-keyword>return</span> render;
  };

  render.x = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>_</span>) </span>{
    <span class=hljs-keyword>if</span> (!<span class=hljs-built_in>arguments</span>.length) <span class=hljs-keyword>return</span> xValue;
    xValue = _;
    <span class=hljs-keyword>return</span> render;
  };

  render.y = <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>_</span>) </span>{
    <span class=hljs-keyword>if</span> (!<span class=hljs-built_in>arguments</span>.length) <span class=hljs-keyword>return</span> yValue;
    yValue = _;
    <span class=hljs-keyword>return</span> render;
  };

  <span class=hljs-keyword>return</span> render;
}</pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-comment>/* --------------------------------------------
 *
 * Constract a bounding box relative in our coordinate space
 * that we can attach arrow starting points to
 *
 * --------------------------------------------
 */</span>
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>getElPosition</span> (<span class=hljs-params>el</span>) </span>{
  <span class=hljs-keyword>const</span> annotationBbox = el.getBoundingClientRect();
  <span class=hljs-keyword>const</span> parentBbox = el.parentNode.getBoundingClientRect();
  <span class=hljs-keyword>const</span> coords = {
    <span class=hljs-attr>top</span>: annotationBbox.top - parentBbox.top,
    <span class=hljs-attr>right</span>: annotationBbox.right - parentBbox.left,
    <span class=hljs-attr>bottom</span>: annotationBbox.bottom - parentBbox.top,
    <span class=hljs-attr>left</span>: annotationBbox.left - parentBbox.left,
    <span class=hljs-attr>width</span>: annotationBbox.width,
    <span class=hljs-attr>height</span>: annotationBbox.height
  };
  <span class=hljs-keyword>return</span> coords;
}</pre> </div><div class=contents style=display:none> <pre class=svelte-1b1cja3><span class=hljs-comment>/* --------------------------------------------
 *
 * Parse various inputs and return then as a number
 * Can be a number, which will return the input value
 * A percentage, which will take the percent of the appropriate dimentions
 * A pixel value, which will parse as a number
 *
 * --------------------------------------------
 */</span>
<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>parseCssValue</span> (<span class=hljs-params>d, i, width, height</span>) </span>{
  <span class=hljs-keyword>if</span> (!d) <span class=hljs-keyword>return</span> <span class=hljs-number>0</span>;
  <span class=hljs-keyword>if</span> (<span class=hljs-keyword>typeof</span> d === <span class=hljs-string>'number'</span>) {
    <span class=hljs-keyword>return</span> d;
  }
  <span class=hljs-keyword>if</span> (d.indexOf(<span class=hljs-string>'%'</span>) > <span class=hljs-number>-1</span>) {
    <span class=hljs-keyword>return</span> ((+d.replace(<span class=hljs-string>'%'</span>, <span class=hljs-string>''</span>)) / <span class=hljs-number>100</span>) * (i ? height : width);
  }
  <span class=hljs-keyword>return</span> +d.replace(<span class=hljs-string>'px'</span>, <span class=hljs-string>''</span>);
}</pre> </div> </div> </div> </div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[{},null,{data:{main:{title:"main.js",contents:"import LayerCake from 'layercake';\nimport { scaleBand } from 'd3-scale';\nimport groups from '.\u002Fdata\u002Fgroups.js';\nimport Column from '.\u002Fcomponents\u002FColumn.html';\nimport AxisX from '.\u002Fcomponents\u002FAxisXScaleBand.html';\nimport AxisY from '.\u002Fcomponents\u002FAxisY.html';\nimport Annotations from '.\u002Fcomponents\u002FAnnotations.html';\nimport Arrows from '.\u002Fcomponents\u002FArrows.html';\nimport DefArrowhead from '.\u002Fcomponents\u002FDefArrowhead.html';\n\nconst annotations = [\n  {\n    text: 'Example text...',\n    top: '18%',\n    left: '30%',\n    arrows: [{\n      clockwise: false, \u002F\u002F true or false, defaults to true\n      source: {\n        anchor: 'left-bottom', \u002F\u002F can be `{left, middle, right},{top-middle-bottom}`\n        dx: -2,\n        dy: -7\n      },\n      target: {\n        x: '28%',\n        y: '75%'\n      }\n    },\n    {\n      source: {\n        anchor: 'right-bottom',\n        dy: -7,\n        dx: 5\n      },\n      target: {\n        x: '68%',\n        y: '48%'\n      }\n    }]\n  }\n];\n\nconst myCake = new LayerCake({\n  padding: { top: 0, right: 0, bottom: 20, left: 20 },\n  x: 'year',\n  y: 'value',\n  xScale: scaleBand().paddingInner([0.02]).round(true),\n  xDomain: ['1979', '1980', '1981', '1982', '1983'],\n  yDomain: [0, null],\n  data: groups,\n  target: document.getElementById('my-chart')\n})\n  .svgLayers([\n    { component: AxisX, opts: { gridlines: false } },\n    { component: AxisY, opts: { gridlines: false, ticks: 3 } },\n    { component: Column, opts: {} }\n  ])\n  .htmlLayers([\n    { component: Annotations, opts: { annotations } }\n  ])\n  .svgLayers([\n    { component: Arrows, opts: { annotations } }\n  ], { defs: DefArrowhead });\n\nmyCake.render();"},components:[{title:".\u002Fcomponents\u002FColumn.html",contents:"{#each $data as d, i}\n  \u003Crect class='group-rect' data-id=\"{i}\" x=\"{x(d)}\" y=\"{y(d)}\" {width} height=\"{height(d)}\"\n  fill={opts.fill || '#00e047'} stroke={opts.stroke || ''} stroke-width={opts['stroke-width'] || ''}\u003E\u003C\u002Frect\u003E\n{\u002Feach}\n\n\u003Cscript\u003E\nexport default {\n  namespace: 'svg',\n  computed: {\n    x: ({ $xGet }) =\u003E {\n      return (d) =\u003E {\n        return $xGet(d);\n      };\n    },\n    y: ({ $yGet }) =\u003E {\n      return (d) =\u003E {\n        return $yGet(d);\n      };\n    },\n    width: ({ $xScale }) =\u003E {\n      return $xScale.bandwidth();\n    },\n    height: ({ $height, $xScale, y }) =\u003E {\n      return (d) =\u003E {\n        return $height - y(d);\n      };\n    }\n  }\n};\n\u003C\u002Fscript\u003E"},{title:".\u002Fcomponents\u002FAxisXScaleBand.html",contents:"\u003Cg class='axis x-axis'\u003E\n  {#each $xScale.domain() as tick}\n    \u003Cg class='tick tick-{ tick }' transform='translate({$xScale(tick)},{$yScale.range()[0]})'\u003E\n      {#if opts.gridlines !== false}\n        \u003Cline y1='{$height * -1}' y2='0' x1='0' x2='0'\u003E\u003C\u002Fline\u003E\n      {\u002Fif}\n      \u003Ctext y='16' x=\"{$xScale.bandwidth() \u002F 2}\"\u003E{opts.formatTick ? opts.formatTick(tick) : tick}\u003C\u002Ftext\u003E\n    \u003C\u002Fg\u003E\n  {\u002Feach}\n\u003C\u002Fg\u003E\n\n\u003Cstyle\u003E\n  .tick {\n    font-size: .725em;\n    font-weight: 200;\n  }\n\n  .tick line {\n    stroke: #aaa;\n    stroke-dasharray: 2;\n  }\n\n  .tick text {\n    fill: #666;\n    text-anchor: start;\n  }\n\n  .tick.tick-0 line {\n    stroke-dasharray: 0;\n  }\n\n  .x-axis .tick text {\n    text-anchor: middle;\n  }\n\u003C\u002Fstyle\u003E\n\n\u003Cscript\u003E\nexport default {\n  namespace: 'svg'\n};\n\u003C\u002Fscript\u003E"},{title:".\u002Fcomponents\u002FAxisY.html",contents:"\u003Cg class='axis y-axis' transform='translate(-{$padding.left}, 0)'\u003E\n  {#each $yScale.ticks(opts.tickNumber || 5) as tick, i}\n    \u003Cg class='tick tick-{tick}' transform='translate(0, {$yScale(tick)})'\u003E\n      {#if opts.gridlines !== false}\n        \u003Cline x2='100%'\u003E\u003C\u002Fline\u003E\n      {\u002Fif}\n      \u003Ctext y='-4'\u003E{opts.formatTick ? opts.formatTick(tick) : tick}\u003C\u002Ftext\u003E\n    \u003C\u002Fg\u003E\n  {\u002Feach}\n\u003C\u002Fg\u003E\n\n\u003Cstyle\u003E\n  .tick {\n    font-size: .725em;\n    font-weight: 200;\n  }\n\n  .tick line {\n    stroke: #aaa;\n    stroke-dasharray: 2;\n  }\n\n  .tick text {\n    fill: #666;\n    text-anchor: start;\n  }\n\n  .tick.tick-0 line {\n    stroke-dasharray: 0;\n  }\n\u003C\u002Fstyle\u003E\n\n\u003Cscript\u003E\nexport default {\n  namespace: 'svg'\n};\n\u003C\u002Fscript\u003E"},{title:".\u002Fcomponents\u002FAnnotations.html",contents:"{#each opts.annotations as d, i}\n  \u003Cdiv class=\"layercake-annotation\" data-id=\"{i}\" style=\"{fillStyle(d)}\"\u003E{d.text}\u003C\u002Fdiv\u003E\n{\u002Feach}\n\n\u003Cstyle\u003E\n  .layercake-annotation {\n    position: absolute;\n  }\n\u003C\u002Fstyle\u003E\n\n\u003Cscript\u003E\nconst vals = ['top', 'right', 'bottom', 'left'];\nexport default {\n  onupdate () {\n    \u002F* --------------------------------------------\n     * Stash this on the store so that our arrow annotation layer can hook onto these DOM elemnts\n     * only after they're created, and then on update\n     *\u002F\n    this.store.set({ annotationEls: document.querySelectorAll('.layercake-annotation') });\n  },\n  computed: {\n    fillStyle: ({ $width, $height }) =\u003E {\n      return d =\u003E {\n        let style = '';\n        vals.forEach(val =\u003E {\n          if (d[val]) {\n            style += `${val}:${d[val]};`;\n          }\n        });\n        return style;\n      };\n    }\n  }\n};\n\u003C\u002Fscript\u003E"},{title:".\u002Fcomponents\u002FArrows.html",contents:"{#if opts.annotations}\n  \u003Cg class=\"swoops\"\u003E\n    {#each opts.annotations as anno, i}\n      {#if anno.arrows}\n        {#each anno.arrows as arrow}\n          \u003Cpath marker-end='url(#arrowhead)' d='{d(anno, i, arrow)}'\u003E\u003C\u002Fpath\u003E\n        {\u002Feach}\n      {\u002Fif}\n    {\u002Feach}\n  \u003C\u002Fg\u003E\n{\u002Fif}\n\n\u003Cstyle\u003E\n  .swoops {\n    position: absolute;\n    max-width: 200px;\n    line-height: 14px;\n  }\n  .swoops path {\n    fill: none;\n    stroke: #000;\n    stroke-width: 1;\n  }\n\u003C\u002Fstyle\u003E\n\n\u003Cscript\u003E\nimport swoopyArrow from '..\u002Fmodules\u002FswoopyArrow.js';\nimport getElPosition from '..\u002Fmodules\u002FgetElPosition.js';\nimport parseCssValue from '..\u002Fmodules\u002FparseCssValue.js';\n\n\u002F* --------------------------------------------\n * Some lookups to convert between x, y \u002F width, height terminology\n * and CSS names\n *\u002F\nconst lookups = [\n  { dimension: 'width', css: 'left', position: 'x' },\n  { dimension: 'height', css: 'top', position: 'y' }\n];\n\nexport default {\n  namespace: 'svg',\n  computed: {\n    d: ({ $width, $height, opts, $annotationEls }) =\u003E {\n      return (anno, i, arrow) =\u003E {\n        if ($annotationEls) {\n          const el = $annotationEls[i];\n          \u002F\u002F const el = document.querySelector(`.layercake-annotation[data-id=\"${i}\"]`);\n          \u002F* --------------------------------------------\n           * Parse our attachment directives to know where to start the arrowhead\n           * measuring a bounding box based on our annotation el\n           *\u002F\n          const arrowSource = getElPosition(el);\n          const sourceCoords = arrow.source.anchor.split('-').map((d, i) =\u003E {\n            const point = d === 'middle' ? arrowSource[lookups[i].css] + (arrowSource[lookups[i].dimension] \u002F 2) : arrowSource[d];\n            return point + (parseCssValue(arrow.source[`d${lookups[i].position}`], i, arrowSource.width, arrowSource.height));\n          });\n\n          \u002F* --------------------------------------------\n           * Default to clockwise\n           *\u002F\n          const clockwise = typeof arrow.clockwise === 'undefined' ? true : arrow.clockwise;\n\n          \u002F* --------------------------------------------\n           * Parse where we're drawing to\n           *\u002F\n          const targetCoords = [arrow.target.x, arrow.target.y].map((d, i) =\u003E {\n            return parseCssValue(d, i, $width, $height);\n          });\n\n          \u002F* --------------------------------------------\n           * Create arrow path\n           *\u002F\n          const d = swoopyArrow()\n            .angle(Math.PI \u002F 2)\n            .clockwise(clockwise)\n            .x(d =\u003E d[0])\n            .y(d =\u003E d[1])([sourceCoords, targetCoords]);\n\n          return d;\n        }\n        return '';\n      };\n    }\n  }\n};\n\u003C\u002Fscript\u003E"},{title:".\u002Fcomponents\u002FDefArrowhead.html",contents:"\u003Cdefs\u003E\n  \u003Cmarker id=\"arrowhead\" viewBox=\"-10 -10 20 20\" markerWidth=\"17\" markerHeight=\"17\" orient=\"auto\"\u003E\n    \u003Cpath d=\"M-6,-6 L 0,0 L -6,6\" fill=\"{opts.fill || '#000'}\"\u002F\u003E\n  \u003C\u002Fmarker\u003E\n\u003C\u002Fdefs\u003E\n\n\u003Cscript\u003E\nexport default {\n  namespace: 'svg'\n};\n\u003C\u002Fscript\u003E"}],modules:[{title:".\u002Fdata\u002Fgroups.js",contents:"export default [\n  {\n    year: '1979',\n    value: 2\n  },\n  {\n    year: '1980',\n    value: 3\n  },\n  {\n    year: '1981',\n    value: 5\n  },\n  {\n    year: '1982',\n    value: 8\n  },\n  {\n    year: '1983',\n    value: 18\n  }\n];"}],componentModules:[{title:"..\u002Fmodules\u002FswoopyArrow.js",contents:"\u002F* --------------------------------------------\n *\n * Adapted from bizweekgraphics\u002Fswoopyarrows\n *\n * --------------------------------------------\n *\u002F\nexport default function swoopyArrow () {\n  let angle = Math.PI;\n  let clockwise = true;\n  let xValue = function(d) { return d[0]; };\n  let yValue = function(d) { return d[1]; };\n\n  function render(data) {\n    data = data.map(function(d, i) {\n      return [xValue.call(data, d, i), yValue.call(data, d, i)];\n    });\n\n    \u002F\u002F get the chord length (\"height\" {h}) between points\n    const h = hypotenuse(data[1][0] - data[0][0], data[1][1] - data[0][1]);\n\n    \u002F\u002F get the distance at which chord of height h subtends {angle} radians\n    const d = h \u002F (2 * Math.tan(angle \u002F 2));\n\n    \u002F\u002F get the radius {r} of the circumscribed circle\n    const r = hypotenuse(d, h \u002F 2);\n\n    \u002F*\n    SECOND, compose the corresponding SVG arc.\n      read up: http:\u002F\u002Fwww.w3.org\u002FTR\u002FSVG\u002Fpaths.html#PathDataEllipticalArcCommands\n      example: \u003Cpath d = \"M 200,50 a 50,50 0 0,1 100,0\"\u002F\u003E\n                          M 200,50                          Moves pen to (200,50);\n                                   a                        draws elliptical arc;\n                                     50,50                  following a degenerate ellipse, r1 == r2 == 50;\n                                                            i.e. a circle of radius 50;\n                                           0                with no x-axis-rotation (irrelevant for circles);\n                                             0,1            with large-axis-flag=0 and sweep-flag=1 (clockwise);\n                                                 100,0      to a point +100 in x and +0 in y, i.e. (300,50).\n    *\u002F\n    const path = 'M ' + data[0][0] + ',' + data[0][1] +\n        ' a ' + r + ',' + r +\n        ' 0 0,' + (clockwise ? '1' : '0') + ' ' +\n        (data[1][0] - data[0][0]) + ',' + (data[1][1] - data[0][1]);\n\n    return path;\n  }\n\n  function hypotenuse(a, b) {\n    return Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));\n  }\n\n  render.angle = function(_) {\n    if (!arguments.length) return angle;\n    angle = Math.min(Math.max(_, 1e-6), Math.PI - 1e-6);\n    return render;\n  };\n\n  render.clockwise = function(_) {\n    if (!arguments.length) return clockwise;\n    clockwise = !!_;\n    return render;\n  };\n\n  render.x = function(_) {\n    if (!arguments.length) return xValue;\n    xValue = _;\n    return render;\n  };\n\n  render.y = function(_) {\n    if (!arguments.length) return yValue;\n    yValue = _;\n    return render;\n  };\n\n  return render;\n}"},{title:"..\u002Fmodules\u002FgetElPosition.js",contents:"\u002F* --------------------------------------------\n *\n * Constract a bounding box relative in our coordinate space\n * that we can attach arrow starting points to\n *\n * --------------------------------------------\n *\u002F\nexport default function getElPosition (el) {\n  const annotationBbox = el.getBoundingClientRect();\n  const parentBbox = el.parentNode.getBoundingClientRect();\n  const coords = {\n    top: annotationBbox.top - parentBbox.top,\n    right: annotationBbox.right - parentBbox.left,\n    bottom: annotationBbox.bottom - parentBbox.top,\n    left: annotationBbox.left - parentBbox.left,\n    width: annotationBbox.width,\n    height: annotationBbox.height\n  };\n  return coords;\n}"},{title:"..\u002Fmodules\u002FparseCssValue.js",contents:"\u002F* --------------------------------------------\n *\n * Parse various inputs and return then as a number\n * Can be a number, which will return the input value\n * A percentage, which will take the percent of the appropriate dimentions\n * A pixel value, which will parse as a number\n *\n * --------------------------------------------\n *\u002F\nexport default function parseCssValue (d, i, width, height) {\n  if (!d) return 0;\n  if (typeof d === 'number') {\n    return d;\n  }\n  if (d.indexOf('%') \u003E -1) {\n    return ((+d.replace('%', '')) \u002F 100) * (i ? height : width);\n  }\n  return +d.replace('px', '');\n}"}],dek:""}}],store:(function(a){return {guideContents:[{metadata:{title:"Introduction"},subsections:[{slug:"what-is-layer-cake-",title:"What is Layer Cake?"},{slug:"getting-started",title:"Getting started"},{slug:"layer-components",title:"Layer components"},{slug:"more-layer-types",title:"More layer types"},{slug:"data-less-cakes",title:"Data-less cakes"}],slug:"introduction"},{metadata:{title:"Store API"},subsections:[{slug:"target-dom-node",title:"target"},{slug:"data-array",title:"data"},{slug:"x-string-function-array",title:"x"},{slug:"y-string-function-array",title:"y"},{slug:"r-string-function-array",title:"r"},{slug:"padding-object",title:"padding"},{slug:"xscale-d3scale-",title:"xScale"},{slug:"yscale-d3scale-",title:"yScale"},{slug:"rscale-d3scale-",title:"rScale"},{slug:"xdomain-array-min-max-",title:"xDomain"},{slug:"ydomain-array-min-max-",title:"yDomain"},{slug:"rdomain-array-min-max-",title:"rDomain"},{slug:"reversex-boolean-false",title:"reverseX"},{slug:"reversey-boolean-true",title:"reverseY"},{slug:"xpadding-array-leftpixels-rightpixels-",title:"xPadding"},{slug:"ypadding-array-leftpixels-rightpixels-",title:"yPadding"},{slug:"rpadding-array-leftpixels-rightpixels-",title:"rPadding"},{slug:"rrange-array-min-max-",title:"rRange"},{slug:"flatdata-array",title:"flatData"}],slug:"store-api"},{metadata:{title:"Cake API"},subsections:[{slug:"cake-svglayers-componentslist-opts-",title:"cake.svgLayers(...)"},{slug:"cake-htmllayers-componentslist-opts-",title:"cake.htmlLayers(...)"},{slug:"cake-canvaslayers-componentslist-opts-",title:"cake.canvasLayers(...)"},{slug:"cake-webgllayers-componentslist-opts-",title:"cake.webglLayers(...)"},{slug:"cake-render-options-",title:"cake.render(...)"}],slug:"cake-api"},{metadata:{title:"Computed Store Properties"},subsections:[{slug:a,title:a},{slug:"xget-datarow-",title:"xGet(...)"},{slug:"yget-datarow-",title:"yGet(...)"},{slug:"rget-datarow-",title:"rGet(...)"}],slug:"computed-store-functions"},{metadata:{title:"Helper functions"},subsections:[{slug:"newdiv-classname-stylesobject-parentdomnode-",title:"newDiv(...)"},{slug:"flatten-data-",title:"flatten(...)"},{slug:"scalecanvas-canvas-ctx-width-height-",title:"scaleCanvas(...)"},{slug:"calcextents-flatdata-fields-",title:"calcExtents(...)"}],slug:"helper-functions"}]}}("box"))};if ('serviceWorker' in navigator) navigator.serviceWorker.register('/service-worker.js');</script><script src=/client/8ac304dd7b3cd135858f/main.js></script> 